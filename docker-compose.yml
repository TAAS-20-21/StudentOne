version: '3'

services:
    eureka:
        image: 'eurekaserver.jar:latest'
        container_name: Eureka
        hostname: eurekahostname
        build:
          context: ./microservizi/EurekaServer
          dockerfile: Dockerfile
        ports:
            - 8761:8761
    
    zuul:
        image: 'zuulapigateway.jar:latest'
        container_name: Zuul
        hostname: zuulhostname
        build:
            context: ./microservizi/ZuulApiGateway
            dockerfile: Dockerfile
        ports:
            - 8080:8080
            
    authentication:
        image: 'authenticationms.jar:latest'
        container_name: Authentication
        hostname: authenticationhostname
        environment:
             - DB_SERVER=db_authenticate
             - POSTGRES_PASSWORD=pie
             - POSTGRES_USER=postgres
             - POSTGRES_DB=Authenticate
             - SPRING_RABBITMQ_HOST=rabbitmq
        build:
            context: ./microservizi/AuthenticationMS
            dockerfile: Dockerfile
        ports:
            - 8081:8081
        links:
            - db_authenticate
        depends_on: 
            - eureka
            - db_authenticate
            
    db_authenticate:
        image: postgres:latest
        container_name: db_authenticate
        restart: always
        environment:
            POSTGRES_DB: Authenticate
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: pie
            PGDATA: /var/lib/postgresql/data
        volumes:
            - db-data:/var/lib/postgresql/data
        ports:
            - 5433:5433
             
    rabbitmq3:
        image: rabbitmq:3-management
        container_name: rabbitmq
        environment:
            RABBITMQ_ERLANG_COOKIE: 'secret cookie here'
        ports:
            - 5672:5672
            - 15672:15672
        
volumes:
   db-data:
   pgadmin-data:
      